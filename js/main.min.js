$(document).ready(function(){function e(){$("#menu ul").hide(),$("#menu ul").children(".current").parent().show(),$("#menu ul:first").show(),$("#menu li a").click(function(){var e=$(this).next();return e.is("ul")&&e.is(":visible")?!1:e.is("ul")&&!e.is(":visible")?($("#menu ul:visible").slideUp("normal"),e.slideDown("normal"),!1):void 0})}$("#menu-toggle").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled")}),$("#menu-toggle-2").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled-2"),$("#menu ul").hide()}),$("#admin-content-div").html($("#personnel-content").html()),$(document).ready(function(){e()}),$("#menu > li#entry-menu-item > a").click(function(e){$("li#personnel-menu-item").removeClass("active"),$("li#entry-menu-item").addClass("active"),$("#admin-content-div").html($("#entry-content").html())}),$("#menu > li#personnel-menu-item > a").click(function(e){$("li#entry-menu-item").removeClass("active"),$("li#personnel-menu-item").addClass("active"),$("#admin-content-div").html($("#personnel-content").html())}),$("#form_newpersonnel").submit(function(e){e.preventDefault();var t={firstname:String($("#pfirstname").val()),lastname:String($("#plastname").val()),policeid:String($("#ppoliceid").val()),emailaddress:String($("#pemailaddress").val()),role:String($("#prole").val())},a=[],n=!0;$.each(t,function(e,t){a.push(e+"="+escape(t)),0===t.trim().length&&(n=!1)}),n&&$.post("executenewpersonnel",a.join("&"),function(e){var e=JSON.parse(e),t=$("#palert-container");"failure"===e.status?t.removeClass("alert-success").addClass("alert-danger"):"success"===e.status&&t.removeClass("alert-danger").addClass("alert-success"),t.html(e.message)})}),$(".login-input").on("focus",function(){$(".login").addClass("focused")}),$("#form_login").submit(function(e){e.preventDefault(),$(".login").removeClass("focused").addClass("loading");var t={policeid:String($("#policeid").val()),secret:String($("#secret").val())},a=[],n=!0;$.each(t,function(e,t){a.push(e+"="+escape(t)),0===t.trim().length&&(n=!1)}),n&&$.post("executelogin",a.join("&"),function(e){var e=JSON.parse(e),t=$("#login-alert-container");"failure"===e.status?($(".login").removeClass("loading"),t.append('<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'),t.removeClass("alert-success").addClass("alert-danger").html(e.message)):"success"===e.status&&($(".login").removeClass("loading"),document.location=e.redirect)})}),$("button.deactivate-personnel").each(function(){var e=$(this),t=String(e.data("personnel")),a="deactivate-personnel=true&ref="+escape(t);e.click(function(e){confirm("Are you sure? Click OK to continue or Cancel to do nothing!")&&(e.preventDefault(),$.post("executepersonnel",a,function(e){e=JSON.parse(e),"success"===e.status&&window.location.reload()}))})}),$("button.activate-personnel").each(function(){var e=$(this),t=String(e.data("personnel")),a="activate-personnel=true&ref="+escape(t);e.click(function(e){confirm("Are you sure? Click OK to continue or Cancel to do nothing!")&&(e.preventDefault(),$.post("executepersonnel",a,function(e){e=JSON.parse(e),"success"===e.status&&window.location.reload()}))})}),$("button.delete-personnel").each(function(){var e=$(this),t=String(e.data("personnel")),a="delete-personnel=true&ref="+escape(t);e.click(function(e){confirm("Are you sure? Click OK to continue or Cancel to do nothing!")&&(e.preventDefault(),$.post("executepersonnel",a,function(e){e=JSON.parse(e),"success"===e.status&&window.location.reload()}))})}),$("#form_newentry").submit(function(e){e.preventDefault(),$("#loadingdiv").show();var t={firstname:String($("#efirstname").val()),lastname:String($("#elastname").val()),othername:String($("#eothername").val()),dob:String($("#edob").val()),sex:String($("#esex").val()),phonenumber:String($("#ephonenumber").val()),emailaddress:String($("#eemailaddress").val()),homeaddress:String($("#ehomeaddress").val()),occupation:String($("#eoccupation").val()),workplace:String($("#eworkplace").val()),workaddress:String($("#eworkaddress").val()),image1:String($("#eimage1").val()),image2:String($("#eimage2").val())},a=[],n=!0;$.each(t,function(e,t){a.push(e+"="+escape(t)),0===t.trim().length&&(n=!1)}),n&&$.post("executenewentry",a.join("&"),function(e,t){var e=JSON.parse(e),a=$("#ealert-container");"failure"===e.status?(a.removeClass("alert-success").addClass("alert-danger"),$("#loadingdiv").hide()):"success"===e.status&&(a.removeClass("alert-danger").addClass("alert-success"),$("#loadingdiv").hide()),a.html(e.message)})}),$("button.edit-entry").each(function(){var e=$(this),t=String(e.data("entry")),a="edit-entry=true&ref="+escape(t);e.click(function(e){e.preventDefault(),$.post("executeeditentry",a,function(e){e=JSON.parse(e),$('#form_editentry input[name="eeothername"]').val(e.Othername),$('#form_editentry input[name="eedob"]').val(e.DOB),$('#form_editentry input[name="eephonenumber"]').val(e.Phonenumber),$('#form_editentry input[name="eeemailaddress"]').val(e.EmailAddress),$('#form_editentry input[name="eehomeaddress"]').val(e.HomeAddress),$('#form_editentry input[name="eeoccupation"]').val(e.Occupation),$('#form_editentry input[name="eeworkplace"]').val(e.WorkPlace),$('#form_editentry input[name="eeworkaddress"]').val(e.WorkAddress),$("#form_editentry button").attr("data-id",e.UniqueID)})})}),$("#form_editentry").submit(function(e){e.preventDefault();var t=String($("#form_editentry button").data("id")),a={othername:String($("#eeothername").val()),dob:String($("#eedob").val()),phonenumber:String($("#eephonenumber").val()),emailaddress:String($("#eeemailaddress").val()),homeaddress:String($("#eehomeaddress").val()),occupation:String($("#eeoccupation").val()),workplace:String($("#eeworkplace").val()),workaddress:String($("#eeworkaddress").val()),id:escape(t)},n=[],s=!0;$.each(a,function(e,t){n.push(e+"="+escape(t)),0===t.trim().length&&(s=!1)}),s&&$.post("executeeditentry",n.join("&"),function(e){var e=JSON.parse(e),t=$("#eealert-container");"failure"===e.status?t.removeClass("alert-success").addClass("alert-danger"):"success"===e.status&&t.removeClass("alert-danger").addClass("alert-success"),t.html(e.message)})}),$("button.train-album").each(function(){var e=$(this),t=String(e.data("entry"));$(this).click(function(e){e.preventDefault(),$("#form_trainalbum").append('<input type="hidden" class="entryid" name="entryid" value="'+t+'" />')})});var t=10,a=$(".imageurl_fields"),n=$(".addimage_field"),s=1;$(n).click(function(e){e.preventDefault(),t>s&&(s++,$(a).append('<div class="form-group"><label class="col-sm-2 control-label">#'+s+'</label><div class="col-sm-6"><input type="text" placeholder="Insert image URL" class="form-control imageurlfield" name="imageURL[]" required /></div><a href="#" class="removeimage_field">Remove</a></div>'))}),$(a).on("click",".removeimage_field",function(e){e.preventDefault(),$(this).parent("div").remove(),s--}),$("#form_trainalbum").submit(function(e){e.preventDefault();var t=$(this),a=[],n={},s=!0;$.each($('#form_trainalbum input[class="imageurlfield"]'),function(){a.push(escape(t.val())),0===t.val().trim().length&&(s=!1)}),n.id=String($('#form_trainalbum input[name="entryid"]').val()),n.dataset=a,s&&$.post("executetrain",JSON.stringify(n),function(e){var e=JSON.parse(e),t=$("#alert-container");"failure"===e.status?t.removeClass("alert-success").addClass("alert-danger"):"success"===e.status&&t.removeClass("alert-danger").addClass("alert-success"),t.html(e.message)})});var i,r,l=document.getElementById("uploadBtn");l.onchange=function(){i=this.value.substr(12),r="http://npfims.com/photos/"+i,document.getElementById("image").value=r},$("#form_search").submit(function(e){e.preventDefault(),$("#loadingdiv").show();var t,a,n=!0;if(l.files.length>0){a=l.files[0],a.type.match("image.*")||(n=!1);var s=new FormData;s.append("file",a,a.name),$.ajax({url:"executeinternal",data:s,cache:!1,contentType:!1,processData:!1,type:"POST",async:!1,success:function(e){var e=JSON.parse(e);"success"===e.status&&(t=r)}})}else t=escape(String($("#image").val())),0===t.trim().length&&(n=!1);n&&$.post("executeinternal",t,function(e){var t,e=JSON.parse(e),a=$("#internal-alert-container"),n=$("#resultModal");"failure"===e.status?(a.removeClass("alert-success").addClass("alert-danger").html(e.message),$("#loadingdiv").hide()):"success"===e.status&&($("#loadingText").html(e.message),"M"===e.details.Sex&&(t="Male"),"F"===e.details.Sex&&(t="Female"),n.find("#displayimage").attr("src",e.details.BaseIMG),n.find("#firstname").html(e.details.Firstname),n.find("#lastname").html(e.details.Lastname),n.find("#othername").html(e.details.Othername),n.find("#dob").html(e.details.DOB),n.find("#sex").html(t),n.find("#email").html(e.details.EmailAddress),n.find("#phonenumber").html(e.details.Phonenumber),n.find("#confidence").html(e.confidence),n.find("#homeaddress").html(e.details.HomeAddress),n.find("#occupation").html(e.details.Occupation),n.find("#workplace").html(e.details.WorkPlace),n.find("#workaddress").html(e.details.WorkAddress),n.modal("show"),setTimeout(function(){$("#loadingdiv").hide()},2e3))})}),$("#logout").click(function(e){e.preventDefault(),$.post("executelogout",null,function(e){var e=JSON.parse(e);document.location=e.redirect})})});